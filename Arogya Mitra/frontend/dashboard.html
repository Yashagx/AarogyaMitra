<!DOCTYPE html>
<html lang="en">
<script src="js/lang.js"></script>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Aarogya Mitra | Dashboard</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #f1f8f4 100%);
            min-height: 100vh;
        }

        /* TOP NAVIGATION BAR */
        .top-nav {
            background: linear-gradient(135deg, #0b5ed7 0%, #0056b3 100%);
            color: white;
            padding: 16px 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1400px;
            margin: auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }

        .brand {
            display: flex;
            flex-direction: column;
        }

        .brand h1 {
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .brand .slogan {
            font-size: 13px;
            opacity: 0.9;
            font-weight: 300;
        }

        .nav-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .nav-btn {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }

        .nav-btn.logout {
            background: #dc3545;
            border-color: #dc3545;
            font-size: 14px;
            font-weight: 600;
        }

        .nav-btn.logout:hover {
            background: #c82333;
        }

        /* MAIN CONTAINER */
        .container {
            padding: 24px;
            max-width: 1400px;
            margin: auto;
        }

        /* WELCOME CARD */
        .welcome-card {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.08);
            margin-bottom: 24px;
            border-left: 6px solid #0b5ed7;
        }

        .welcome-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 16px;
        }

        .welcome-info h2 {
            color: #0b5ed7;
            font-size: 28px;
            margin-bottom: 8px;
        }

        .user-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            font-size: 14px;
            color: #555;
            margin-top: 8px;
        }

        .user-meta div {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .user-meta strong {
            color: #333;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: #e7f5ec;
            color: #198754;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            border: 2px solid #198754;
        }

        /* HEALTH STATUS PANEL */
        .health-status {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            border: 2px dashed #0b5ed7;
        }

        .health-status h3 {
            color: #0b5ed7;
            font-size: 16px;
            margin-bottom: 12px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .status-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .status-icon {
            font-size: 24px;
        }

        .status-text {
            font-size: 13px;
        }

        .status-label {
            color: #666;
            display: block;
        }

        .status-value {
            color: #333;
            font-weight: 600;
            display: block;
        }

        /* SECTION HEADERS */
        .section-header {
            margin: 32px 0 20px 0;
            color: #333;
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* FEATURE CARDS GRID */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .feature-card {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #0b5ed7, #198754);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.12);
            border-color: #0b5ed7;
        }

        .feature-card:hover::before {
            transform: scaleX(1);
        }

        .feature-icon {
            font-size: 42px;
            margin-bottom: 12px;
            display: block;
        }

        .feature-card h3 {
            color: #333;
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .feature-card p {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }

        .feature-card .tag {
            display: inline-block;
            background: #fff3cd;
            color: #856404;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 10px;
        }

        .feature-card.emergency {
            background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
            border-color: #dc3545;
        }

        .feature-card.emergency:hover {
            border-color: #c82333;
        }

        /* FOOTER */
        footer {
            margin-top: 48px;
            padding: 24px;
            text-align: center;
            color: #666;
            font-size: 13px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        footer strong {
            color: #0b5ed7;
        }

        /* NOTIFICATION BADGE */
        .notif-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .nav-btn {
            position: relative;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .brand h1 {
                font-size: 22px;
            }

            .brand .slogan {
                font-size: 11px;
            }

            .nav-btn {
                padding: 8px 12px;
                font-size: 16px;
            }

            .welcome-header {
                flex-direction: column;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                font-size: 18px;
            }
        }

        /* LOADING OVERLAY */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
            gap: 16px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0b5ed7;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #0b5ed7;
            font-weight: 600;
        }
    </style>
</head>
<body>

<!-- LOADING SCREEN -->
<div class="loading" id="loadingScreen">
    <div class="spinner"></div>
    <div class="loading-text">Loading your dashboard...</div>
</div>

<!-- TOP NAVIGATION BAR -->
<nav class="top-nav">
    <div class="nav-container">
        <div class="brand">
            <h1>üè• Aarogya Mitra</h1>
            <div class="slogan">‡§Ü‡§™‡§ï‡§æ ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡§æ‡§•‡•Ä</div>
        </div>
        <div class="nav-actions">
            <button class="nav-btn" onclick="showNotifications()" title="Notifications">
                üîî
                <span class="notif-badge">3</span>
            </button>
            <button class="nav-btn" onclick="toggleLanguage()" title="Change Language">
                üåê
            </button>
            <button class="nav-btn" onclick="viewProfile()" title="My Profile">
                üë§
            </button>
            <button class="nav-btn logout" onclick="handleLogout()">
                üö™ Logout
            </button>
        </div>
    </div>
</nav>

<!-- MAIN CONTAINER -->
<div class="container">

    <!-- WELCOME CARD -->
    <div class="welcome-card">
        <div class="welcome-header">
            <div class="welcome-info">
                <h2 id="welcomeText">Welcome</h2>
                <div class="user-meta">
                    <div>
                        <span>üÜî ABHA ID:</span>
                        <strong id="abhaId">Loading...</strong>
                    </div>
                    <div>
                        <span>üìç Location:</span>
                        <strong id="location">Loading...</strong>
                    </div>
                    <div>
                        <span>üì± Mobile:</span>
                        <strong id="mobile">Loading...</strong>
                    </div>
                </div>
            </div>
            <div class="badge">
                ‚úì ABHA Verified
            </div>
        </div>

        <!-- HEALTH STATUS PANEL -->
        <div class="health-status">
            <h3>üìä Quick Health Status</h3>
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-icon">üíö</div>
                    <div class="status-text">
                        <span class="status-label">Current Status</span>
                        <span class="status-value">No Active Symptoms</span>
                    </div>
                </div>
                <div class="status-item">
                    <div class="status-icon">üìÖ</div>
                    <div class="status-text">
                        <span class="status-label">Last Visit</span>
                        <span class="status-value">Not recorded</span>
                    </div>
                </div>
                <div class="status-item">
                    <div class="status-icon">üíä</div>
                    <div class="status-text">
                        <span class="status-label">Active Prescriptions</span>
                        <span class="status-value">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PRIMARY FEATURES -->
    <div class="section-header">ü©∫ Healthcare Services</div>
    <div class="feature-grid">
        <div class="feature-card" onclick="window.location.href='symptom-checker.html'">
            <span class="feature-icon">ü©∫</span>
            <h3>Symptom Checker</h3>
            <p>Report your symptoms in your own language and get instant AI-powered health guidance.</p>
        </div>

        <div class="feature-card emergency" onclick="navigateTo('emergency')">
            <span class="feature-icon">üöë</span>
            <h3>Emergency Ambulance</h3>
            <p>One-click ambulance booking with GPS tracking and first-aid instructions.</p>
            <span class="tag">‚ö° URGENT</span>
        </div>

        <div class="feature-card" onclick="window.location.href='aarogyaconnect.html'">
            <span class="feature-icon">üë®‚Äç‚öïÔ∏è</span>
            <h3>Aarogya Connect</h3>
            <p>Find nearby doctors, specialists, and book appointments easily.</p>
        </div>

        <div class="feature-card" onclick="navigateTo('teleconsult')">
            <span class="feature-icon">üìû</span>
            <h3>Teleconsultation</h3>
            <p>Video consultation with doctors from home. No travel needed.</p>
            <span class="tag">NEW</span>
        </div>

    

        <div class="feature-card" onclick="navigateTo('medicine')">
            <span class="feature-icon">üíä</span>
            <h3>Medicine Availability</h3>
            <p>Check real-time availability of medicines at nearby pharmacies.</p>
        </div>
    </div>

    <!-- RECORDS & REPORTS -->
    <div class="section-header">üìÇ My Health Records</div>
    <div class="feature-grid">
       <div class="feature-card" onclick="window.location.href='health-records.html'">
    <span class="feature-icon">üìÇ</span>
    <h3>Health Records</h3>
    <p>Access your complete medical history, prescriptions, and reports securely.</p>
</div>
<div class="feature-card" onclick="window.location.href='prescriptions.html'">
    <span class="feature-icon">üßæ</span>
    <h3>My Prescriptions</h3>
    <p>View all your past and current prescriptions in one place.</p>
</div>
<div class="feature-card" onclick="window.location.href='lab-reports.html'">
    <span class="feature-icon">üß™</span>
    <h3>Lab Reports</h3>
    <p>Download and share your blood tests, X-rays, and scan reports.</p>
</div>

        <div class="feature-card" onclick="navigateTo('analytics')">
            <span class="feature-icon">üìä</span>
            <h3>Aarogya View</h3>
            <p>Visual insights on local disease trends and health statistics.</p>
        </div>
    </div>

    <!-- GOVERNMENT SCHEMES & INFO -->
    <div class="section-header">üèõÔ∏è Government Health Schemes</div>
    <div class="feature-grid">
        <div class="feature-card" onclick="navigateTo('ayushman')">
            <span class="feature-icon">üèõÔ∏è</span>
            <h3>Ayushman Bharat</h3>
            <p>Check your eligibility for PM-JAY and access ‚Çπ5 lakh health coverage.</p>
        </div>

        <div class="feature-card" onclick="navigateTo('schemes')">
            <span class="feature-icon">üìã</span>
            <h3>Health Schemes</h3>
            <p>Information on government health programs, subsidies, and benefits.</p>
        </div>

        <div class="feature-card" onclick="navigateTo('first-aid')">
            <span class="feature-icon">ü©π</span>
            <h3>First Aid Tips</h3>
            <p>Offline-friendly emergency first aid guidance in simple language.</p>
            <span class="tag">OFFLINE</span>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <strong>¬© 2025 Aarogya Mitra</strong> ¬∑ Built with care for Rural India<br>
        A Digital India Initiative ¬∑ Powered by ABHA & National Health Authority<br>
        <small style="color: #999; margin-top: 8px; display: block;">
            For support: üìû 1800-XXX-XXXX | üìß support@aarogyamitra.gov.in
        </small>
    </footer>

</div>

<script>
    // SESSION MANAGEMENT
    const name = sessionStorage.getItem("am_name");
    const mobile = sessionStorage.getItem("am_mobile");

    // Session Safety Check
    if (!name || !mobile) {
        alert("‚ö†Ô∏è Session expired. Please sign up again.");
        window.location.href = "index.html";
    }

    // LOAD USER PROFILE
    window.addEventListener('DOMContentLoaded', () => {
        loadUserProfile();
    });

    function loadUserProfile() {
        fetch(`/api/abha/profile?name=${encodeURIComponent(name)}&mobile=${mobile}`)
            .then(res => {
                if (!res.ok) throw new Error('Profile fetch failed');
                return res.json();
            })
            .then(data => {
                document.getElementById("welcomeText").innerText = `Welcome, ${data.name}! üëã`;
                document.getElementById("abhaId").innerText = data.abhaId || "Not available";
                document.getElementById("mobile").innerText = mobile || "Not available";

                if (data.address) {
                    const location = `${data.address.tehsil || data.tehsil || 'Unknown'}, ${data.address.district || 'Unknown'} - ${data.address.pincode || ''}`;
                    document.getElementById("location").innerText = location;
                } else {
                    document.getElementById("location").innerText = "Not provided";
                }

                // Hide loading screen
                document.getElementById('loadingScreen').style.display = 'none';
            })
            .catch(error => {
                console.error('Profile load error:', error);
                alert("‚ö†Ô∏è Unable to load your profile. Please login again.");
                window.location.href = "index.html";
            });
    }

    // NAVIGATION FUNCTIONS
    function navigateTo(feature) {
        alert(`üöÄ Navigating to: ${feature}\n\nThis feature will be available soon!`);
        // In production: window.location.href = `${feature}.html`;
    }

    function showNotifications() {
        alert("üîî Notifications:\n\n1. Your teleconsultation is scheduled for tomorrow\n2. New prescription available\n3. Health checkup reminder");
    }

    function toggleLanguage() {
        const langs = ['English', '‡§π‡§ø‡§Ç‡§¶‡•Ä', '‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä', '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å', '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç'];
        const current = langs[Math.floor(Math.random() * langs.length)];
        alert(`üåê Language switched to: ${current}\n\n(In production, this will reload the interface)`);
    }

    function viewProfile() {
        alert(`üë§ Profile Details:\n\nName: ${name}\nMobile: ${mobile}\nABHA ID: Verified\n\n(Opening full profile...)`);
        // In production: window.location.href = 'profile.html';
    }

    // LOGOUT HANDLER
    function handleLogout() {
        const confirmed = confirm("üö™ Are you sure you want to logout?\n\nYou will need to login again to access your dashboard.");
        
        if (confirmed) {
            // Clear session
            sessionStorage.clear();
            
            // Call logout API
            fetch("/api/logout", { method: "POST" })
                .then(() => {
                    alert("‚úÖ Logged out successfully!");
                    window.location.replace("loggedout.html");
                })
                .catch(() => {
                    // Even if API fails, clear session locally
                    window.location.replace("index.html");
                });
        }
    }

    // PREVENT BACK NAVIGATION AFTER LOGOUT
    history.pushState(null, "", location.href);

    window.onpopstate = function () {
        const confirmLogout = confirm(
            "‚ö†Ô∏è Going back will logout your session.\n\nAre you sure you want to continue?"
        );

        if (confirmLogout) {
            handleLogout();
        } else {
            history.pushState(null, "", location.href);
        }
    };

    // PREVENT ACCIDENTAL PAGE REFRESH
    window.addEventListener('beforeunload', function (e) {
        e.preventDefault();
        e.returnValue = '';
    });
</script>

</body>
</html>