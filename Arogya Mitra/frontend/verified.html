<!DOCTYPE html>
<html lang="en">
<script src="js/lang.js"></script>
<head>
    <meta charset="UTF-8">
    <title>Aarogya Mitra | ABHA Verified</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            background: #f4f8fb;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .lang-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .card {
            background: white;
            max-width: 420px;
            width: 100%;
            padding: 24px;
            border-radius: 10px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.1);
            text-align: center;
        }

        h2 {
            color: #198754;
            margin-bottom: 10px;
        }

        .info {
            margin: 16px 0;
            font-size: 15px;
            color: #333;
            white-space: pre-line;
        }

        .badge {
            background: #e7f5ec;
            color: #198754;
            padding: 8px;
            border-radius: 6px;
            font-size: 13px;
            margin-bottom: 16px;
        }

        button {
            padding: 12px;
            width: 100%;
            background: #0b5ed7;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
        }

        button:hover {
            background: #094bb5;
        }

        .note {
            font-size: 12px;
            color: #666;
            margin-top: 12px;
        }
    </style>
</head>

<body>

<!-- ðŸŒ Language Toggle -->
<div class="lang-toggle">
    <select onchange="setLanguage(this.value)">
        <option value="en">English</option>
        <option value="hi">à¤¹à¤¿à¤‚à¤¦à¥€</option>
    </select>
</div>

<div class="card">
    <h2 data-i18n="abha_verified">âœ“ ABHA Verified</h2>

    <div class="badge">
        Verified via Ayushman Bharat Digital Mission (Mock)
    </div>

    <div id="info" class="info" data-i18n="loading">
        Loading your ABHA details...
    </div>

    <button onclick="goNext()" data-i18n="continue">
        Continue
    </button>

    <div class="note" data-i18n="immutable_note">
        These details are fetched securely and cannot be edited.
    </div>
</div>

<!-- ðŸŒ Language Engine -->
<script src="js/lang.js"></script>


<script src="js/lang.js"></script>

<script>
    // ðŸ”’ Prevent browser from caching this page
    window.addEventListener("pageshow", function (event) {
        if (event.persisted) {
            window.location.href = "index.html";
        }
    });

    const name = sessionStorage.getItem("am_name");
    const mobile = sessionStorage.getItem("am_mobile");
    const consumed = sessionStorage.getItem("verified_consumed");

    // ðŸš« If already consumed OR no session â†’ block access
    if (!name || !mobile || consumed === "true") {
        alert("This page has expired. Please continue from login.");
        window.location.replace("index.html");
    }

    // âœ… Fetch ABHA profile (allowed only once)
    fetch(`/api/abha/profile?name=${encodeURIComponent(name)}&mobile=${mobile}`)
        .then(res => {
            if (!res.ok) throw new Error();
            return res.json();
        })
        .then(d => {
            // âœ… Display ABHA home_state (randomly assigned once, permanent)
            document.getElementById("info").innerText =
`${d.name}
ABHA ID: ${d.abhaId}
${d.gender}, ${d.age}
Home State: ${d.homeState}`;
        })
        .catch(() => {
            alert("Unable to load ABHA profile.");
            window.location.replace("index.html");
        });

    function goNext() {
        // âœ… Mark this page as used
        sessionStorage.setItem("verified_consumed", "true");

        // âœ… Replace history so back button skips this page
        window.location.replace("address.html");
    }
</script>


</body>
</html>